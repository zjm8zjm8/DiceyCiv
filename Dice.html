<!DOCTYPE html>
<html>
  <head>
    <title>Tower of Dice</title>
    <style>
      #text {
        cursor: pointer;
        cursor: pointer;
        width: 40px;
        height: 40px;
      }
    </style>
  </head>
	<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
  <body>
	<div id="Wheat">0 food</div><br>
	<div id="Wood">0 wood</div><br>
	<div id = 'diceArea'><!--<img id='1' src='./onedie.png' draggable="true" ondragstart="drag(event)" dieVal='1'></img>
	<img id='2' src='./twodie.png' draggable="true" ondragstart="drag(event)" dieVal='2'></img>--></div>
	<div id = 'cardArea'>
		<table>
			<tr>
				<td id="cardArea1">
				</td>
				<td id="cardArea2">
				</td>
				<td id="cardArea3">
				</td>
				<td id="cardArea4">
				</td>
			</tr>
			<tr>
				<td id="cardArea5">
				</td>
				<td id="cardArea6">
				</td>
				<td id="cardArea7">
				</td>
				<td id="cardArea8">
				</td>
			</tr>
		</table>
	</div>
	<div id='buttonArea'><button onclick="startDay()">Start the Day</button></div>
	<audio autoplay='false' controls='false' src='./sounds/roll.wav' id='rollAudio' hidden></audio>
  </body>
  
  <script>
  var wh = 4;
  var wood = 0;
  var population = 2;
  var cardsAssigned = 0;
  var currentDie;
  
  window.onload = function(e){
	showStoryIntro();
	createScroungingCard();
	createFarmingCard();
	createSticksCard();
	repaintResources();
  }
  
  function showStoryIntro(){
	alert("Legend tells of a dicey kingdom that existed long ago. A land where dice were free to roll how they may. It was destroyed by the FOUR DICEMEN OF THE APOCALYPSE. You are in an idyllic meadow, and the thought strikes you that you might be the one who could rebuild the KINGDOM OF DICE.");
  }
  
  function allowDrop(event){
	event.preventDefault();
  }
  
  function drag(event){
	event.dataTransfer.setData("text", event.target.id);
  }
  
  // Using callback to allow cards to specify function on the fly.
  function drop(event, callback){
	event.preventDefault();
	var selDie = event.dataTransfer.getData("text");
	currentDie = event.dataTransfer.getData("text");
	callback(Number($("#"+selDie).data("dieVal")));
  }
  
  function removeDie()
  {
	if (currentDie.length > 0)
		document.getElementById(currentDie).remove();
	currentDie = "";
  }
  
  function scroungeWheat(){
	wh += 2;
	repaintResources();
	removeDie();
  }
  function farmWheat(amount){
	wh += amount;
	repaintResources();
	removeDie();
  }
  function gatherSticks(amount){
	if (amount < 4){
		return false;
	}
	wood += amount - 3;
	repaintResources();
	removeDie();
  }
  
  function startDay(){
	wh -= population;
	document.getElementById('diceArea').innerHTML = ""; // Clear the dice.
	if (wh < 0){
		generateDice(0)
		wh = 0;
	}
	else{
		for (let i = 0; i < population; i++){
			generateDice(0);
		}
	}
	repaintResources();
	$("#rollAudio")[0].play();
  }
  function generateDice(value){
	var dieVal = 0;
	if (value == 0){
		dieVal = getRandomDieRoll();
	}
	else{
		dieVal = value;
	}
	var id = generateId();
	var imgsrc = lookupImageSource(dieVal);
	var element = "<img id='"+id+"' src='"+imgsrc+"' draggable='true' ondragstart='drag(event)'></img>";
	$("#diceArea").append(element);
	$("#"+id).data("dieVal", dieVal);
	return 0;
	}
	
	function getRandomDieRoll(){
		return Math.floor(Math.random()*6)+1;
	}
	
	function lookupImageSource(value){
		switch(value)
		{
			case 1:
				return "./images/onedie.png";
			case 2:
				return "./images/twodie.png";
			case 3:
				return "./images/threedie.png";
			case 4:
				return "./images/fourdie.png";
			case 5:
				return "./images/fivedie.png";
			case 6:
				return "./images/sixdie.png";
			case 7:
				return "./images/sevendie.png";
			case 8:
				return "./images/eightdie.png";
			case 9:
				return "./images/ninedie.png";
			case 10:
				return "./images/tendie.png";
			default:
				return "./images/emptydie.png";
		
		}
	}
	
	function generateId(){
		var text = '';
		var possible = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';

		for(var i=0; i < 24; i++)
		{
			text += possible.charAt(Math.floor(Math.random() * possible.length));
		}

		return text;
	}
	function createScroungingCard(){
		var card = "<div id='scrounge' style='border: 2px solid; border-radius: 5px; background-color: #dddd00'>Scrounge<BR>Gain 2 food.<br><img src='./images/emptydie.png' ondrop='drop(event, scroungeWheat)' ondragover='allowDrop(event)'></img></div>";
		addCard(card);
	}
	function createFarmingCard(){
		var card = "<div id='farm' style='border: 2px solid; border-radius: 5px; background-color: #dddd00'>Farm Wheat<BR>Gain X food.<br><img src='./images/emptydie.png' ondrop='drop(event, farmWheat)' ondragover='allowDrop(event)'></img></div>";
		addCard(card);
	}
	function createSticksCard(){
		var card = "<div id='sticks' style='border: 2px solid; border-radius: 5px; background-color: #128822'>Gather Sticks<BR>Gain X-3 wood.<br>Min Die: 4<br><img src='./images/emptydie.png' ondrop='drop(event, gatherSticks)' ondragover='allowDrop(event)'></img></div>";
		addCard(card);
	}
	function addCard(cardData){
		if (cardsAssigned < 8){
			cardsAssigned++;
			let cardstr = "cardArea" + cardsAssigned + "";
			console.log(cardstr);
			document.getElementById(cardstr).innerHTML += cardData;
		}
	}
	function repaintResources(){
		if (wh <= 0){
			document.getElementById('Wheat').innerHTML = "<font color=red>" + wh + "</font> food";
		}
		else{
			document.getElementById('Wheat').innerHTML = wh + " food";
		}
		document.getElementById('Wood').innerHTML = wood + " wood";
	}
  </script>
</html>